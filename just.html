{% extends "body.html" %}

{% block allcontent %}
<style>
    :root {
        --primary-color: #4361ee;
        --primary-light: #e0e7ff;
        --secondary-color: #3a0ca3;
        --accent-color: #4cc9f0;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --light-color: #f8fafc;
        --dark-color: #1e293b;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --border-radius: 12px;
        --border-radius-sm: 8px;
        --card-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* YouTube-like Main Layout */
    .youtube-layout {
        display: flex;
        gap: 20px;
        margin-top: 10px;
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Main Video Player Area */
    .main-video-area {
        flex: 3;
        min-width: 0;
    }

    /* Video Player Container */
    .video-player-container {
        background: var(--dark-color);
        border-radius: var(--border-radius);
        overflow: hidden;
        margin-bottom: 16px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .video-player-wrapper {
        position: relative;
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
    }

    .video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    .video-info {
        padding: 16px;
        background: white;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
    }

    .video-title-main {
        font-family: 'Poppins', sans-serif;
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 12px;
        line-height: 1.4;
    }

    .video-meta-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--gray-200);
        margin-bottom: 12px;
        font-size: 0.9rem;
    }

    .video-stats-main {
        display: flex;
        align-items: center;
        gap: 16px;
        color: var(--gray-600);
    }

    .video-actions {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: var(--gray-100);
        border: none;
        border-radius: 18px;
        color: var(--gray-700);
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.85rem;
    }

    .action-btn:hover {
        background: var(--gray-200);
    }

    .action-btn.like:hover {
        background: var(--primary-light);
        color: var(--primary-color);
    }

    .action-btn.share:hover {
        background: #e0f2fe;
        color: var(--accent-color);
    }

    .video-description {
        color: var(--gray-600);
        line-height: 1.5;
        margin-bottom: 0;
        padding: 12px;
        background: var(--gray-50);
        border-radius: var(--border-radius-sm);
        font-size: 0.9rem;
    }

    /* YOUTUBE-STYLE SIDEBAR (Right side) - EXACT YouTube measurements */
    .video-sidebar {
        flex: 1;
        min-width: 320px;
        max-width: 400px;
    }

    .sidebar-section {
        margin-bottom: 20px;
    }

    .sidebar-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--gray-200);
    }

    /* YOUTUBE-EXACT VIDEO LIST - Small measurements like YouTube */
    .video-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .sidebar-video-card {
        display: flex;
        gap: 8px;
        cursor: pointer;
        transition: var(--transition);
        padding: 4px;
        border-radius: 4px;
    }

    .sidebar-video-card:hover {
        background: var(--gray-50);
    }

    .sidebar-thumbnail {
        position: relative;
        width: 168px; /* YouTube's exact thumbnail width */
        height: 94px; /* YouTube's exact thumbnail height */
        border-radius: 6px;
        overflow: hidden;
        flex-shrink: 0;
    }

    .sidebar-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .sidebar-duration {
        position: absolute;
        bottom: 4px;
        right: 4px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 2px 4px;
        border-radius: 2px;
        font-size: 11px;
        font-weight: 500;
    }

    .sidebar-video-info {
        flex: 1;
        min-width: 0;
        padding: 2px 0;
    }

    .sidebar-video-title {
        font-size: 14px; /* YouTube's exact font size */
        font-weight: 500;
        color: var(--dark-color);
        margin-bottom: 4px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        max-height: 32px;
    }

    .sidebar-video-channel {
        font-size: 12px; /* YouTube's exact font size */
        color: var(--gray-600);
        margin-bottom: 2px;
    }

    .sidebar-video-stats {
        font-size: 12px;
        color: var(--gray-500);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Notes Section */
    .sidebar-notes-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .sidebar-note-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: var(--gray-50);
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        border-left: 3px solid var(--primary-color);
    }

    .sidebar-note-card:hover {
        background: var(--gray-100);
    }

    .sidebar-note-icon {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        background: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        flex-shrink: 0;
    }

    .sidebar-note-info {
        flex: 1;
        min-width: 0;
    }

    .sidebar-note-title {
        font-size: 13px;
        font-weight: 500;
        color: var(--dark-color);
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .sidebar-note-course {
        font-size: 11px;
        color: var(--gray-600);
    }

    /* YOUTUBE-STYLE VIDEO GRID - EXACT YouTube arrangement */
    .videos-grid-container {
        margin-top: 20px;
    }

    .videos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* YouTube's responsive grid */
        gap: 16px;
        margin-top: 16px;
    }

    @media (min-width: 1500px) {
        .videos-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
    }

    @media (max-width: 1100px) {
        .videos-grid {
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
        }
    }

    @media (max-width: 900px) {
        .videos-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
    }

    /* YOUTUBE VIDEO CARD - Small measurements */
    .video-card {
        cursor: pointer;
        transition: transform 0.2s;
        margin-bottom: 4px;
    }

    .video-card:hover {
        transform: translateY(-2px);
    }

    .thumbnail-container {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9; /* YouTube's exact aspect ratio */
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .video-thumbnail {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .video-card:hover .video-thumbnail {
        transform: scale(1.03);
    }

    .video-duration {
        position: absolute;
        bottom: 6px;
        right: 6px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 2px 4px;
        border-radius: 2px;
        font-size: 11px;
        font-weight: 500;
    }

    .video-info-container {
        display: flex;
        gap: 10px;
        padding: 0 4px;
    }

    .channel-avatar {
        width: 32px; /* YouTube's small avatar size */
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 12px;
        color: white;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .video-details {
        flex: 1;
        min-width: 0;
    }

    .video-title {
        color: var(--gray-800);
        font-size: 14px; /* YouTube's exact title size */
        font-weight: 500;
        margin-bottom: 6px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2; /* YouTube shows 2 lines */
        -webkit-box-orient: vertical;
        overflow: hidden;
        max-height: 36px;
    }

    .video-channel {
        color: var(--gray-600);
        font-size: 12px; /* YouTube's channel name size */
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .video-stats {
        color: var(--gray-500);
        font-size: 12px; /* YouTube's stats size */
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Main Tabs */
    .main-tabs {
        display: flex;
        background: white;
        border-radius: 8px;
        margin: 20px auto;
        max-width: 1400px;
        overflow-x: auto;
        box-shadow: var(--card-shadow);
        flex-wrap: nowrap;
        white-space: nowrap;
        padding: 4px;
    }

    .main-tab-btn {
        padding: 10px 16px;
        border: none;
        background: none;
        cursor: pointer;
        font-family: 'Inter', sans-serif;
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--gray-600);
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border-radius: 6px;
        margin: 0 2px;
    }

    .main-tab-btn:hover {
        background: var(--gray-100);
    }

    .main-tab-btn.active {
        background: var(--primary-color);
        color: white;
    }

    /* Notes Grid */
    .notes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 16px;
        margin-top: 16px;
    }

    .note-card {
        background: var(--gray-50);
        border-radius: 8px;
        padding: 16px;
        cursor: pointer;
        transition: var(--transition);
        border-left: 3px solid var(--primary-color);
    }

    .note-card:hover {
        background: var(--gray-100);
        transform: translateY(-2px);
    }

    .note-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .note-icon {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: white;
    }

    .note-title {
        font-size: 14px;
        font-weight: 500;
        color: var(--gray-800);
        margin-bottom: 4px;
        line-height: 1.3;
    }

    .note-course {
        color: var(--gray-600);
        font-size: 12px;
    }

    .note-description {
        color: var(--gray-600);
        font-size: 12px;
        margin-bottom: 12px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .note-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--gray-500);
        font-size: 11px;
    }

    /* Filter Bar */
    .filter-bar {
        background: white;
        padding: 16px;
        border-radius: 8px;
        margin: 20px auto;
        max-width: 1400px;
        box-shadow: var(--card-shadow);
    }

    .filter-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
    }

    .search-box {
        flex: 1;
        min-width: 200px;
    }

    .form-control {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid var(--gray-300);
        border-radius: 20px;
        font-size: 0.9rem;
        font-family: 'Inter', sans-serif;
        transition: var(--transition);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    .select-control {
        padding: 8px 14px;
        border: 1px solid var(--gray-300);
        border-radius: 20px;
        font-size: 0.85rem;
        background: white;
        cursor: pointer;
        min-width: 150px;
        transition: var(--transition);
    }

    .select-control:focus {
        outline: none;
        border-color: var(--primary-color);
    }

    /* Buttons */
    .btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        font-family: 'Inter', sans-serif;
        font-size: 0.85rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        text-decoration: none;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
    }

    .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
    }

    .btn-outline:hover {
        background-color: var(--primary-light);
    }

    /* Content Sections */
    .content-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: var(--card-shadow);
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        background: white;
        border-radius: 8px;
        box-shadow: var(--card-shadow);
        margin-top: 20px;
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        background: var(--gray-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 2rem;
        color: var(--gray-400);
    }

    .empty-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.3rem;
        color: var(--gray-600);
        margin-bottom: 10px;
    }

    .empty-text {
        color: var(--gray-500);
        max-width: 400px;
        margin: 0 auto 20px;
        font-size: 0.95rem;
        line-height: 1.5;
    }

    /* Resources Header */
    .resources-header {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 30px 20px;
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
    }

    .header-content {
        position: relative;
        z-index: 2;
    }

    .page-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        font-size: 1.8rem;
        backdrop-filter: blur(5px);
    }

    .page-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.8rem;
        margin-bottom: 10px;
        font-weight: 700;
        text-align: center;
    }

    .page-subtitle {
        font-size: 1rem;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
        text-align: center;
    }

    /* Tab Content */
    .tab-content {
        display: none;
        animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .youtube-layout {
            flex-direction: column;
        }
        
        .video-sidebar {
            min-width: 100%;
            max-width: 100%;
        }
        
        .video-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
        }
        
        .sidebar-video-card {
            flex-direction: column;
        }
        
        .sidebar-thumbnail {
            width: 100%;
            height: 180px;
        }
    }

    @media (max-width: 768px) {
        .videos-grid {
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .notes-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .filter-group {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-box, .select-control {
            width: 100%;
        }
    }

    @media (max-width: 480px) {
        .videos-grid, .notes-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .content-section {
            padding: 16px;
        }
        
        .video-meta-main {
            flex-direction: column;
            gap: 12px;
            align-items: flex-start;
        }
        
        .video-actions {
            width: 100%;
            justify-content: space-between;
        }
    }
</style>

<div class="dashboard-content">
    <!-- Resources Header -->
    <header class="resources-header">
        <div class="header-content">
            <div class="page-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h1 class="page-title">Course Content</h1>
            <p class="page-subtitle">Watch videos and access notes organized by course</p>
        </div>
    </header>

    <!-- Main Tabs -->
    <div class="main-tabs">
        <button class="main-tab-btn active" onclick="switchMainTab('home')">
            <i class="fas fa-home"></i> Home
        </button>
        <button class="main-tab-btn" onclick="switchMainTab('videos')">
            <i class="fas fa-play-circle"></i> Videos
        </button>
        <button class="main-tab-btn" onclick="switchMainTab('notes')">
            <i class="fas fa-file-alt"></i> Notes
        </button>
        <button class="main-tab-btn" onclick="switchMainTab('courses')">
            <i class="fas fa-graduation-cap"></i> Courses
        </button>
        <button class="main-tab-btn" onclick="window.location.href='/upload'">
            <i class="fas fa-cloud-upload-alt"></i> Upload
        </button>
    </div>

    <!-- Home Tab (YouTube-like Layout) -->
    <div id="home-tab" class="tab-content active">
        <!-- Video Player with Recommendations -->
        <div id="video-view" style="display: block;">
            <div class="youtube-layout">
                <!-- Main Video Player Area -->
                <div class="main-video-area">
                    <div class="video-player-container">
                        <div class="video-player-wrapper">
                            <iframe class="video-player" id="mainVideoPlayer" 
                                    src="https://www.youtube.com/embed/rygBYwF_4Bc"
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen></iframe>
                        </div>
                        <div class="video-info">
                            <h1 class="video-title-main" id="mainVideoTitle">Calculus Basics: Derivatives Explained</h1>
                            <div class="video-meta-main">
                                <div class="video-stats-main" id="mainVideoStats">
                                    <span>1.2K views</span>
                                    <span>•</span>
                                    <span>2 days ago</span>
                                </div>
                                <div class="video-actions">
                                    <button class="action-btn like" onclick="likeVideo()">
                                        <i class="fas fa-thumbs-up"></i> <span id="likeCount">45</span>
                                    </button>
                                    <button class="action-btn share" onclick="shareVideo()">
                                        <i class="fas fa-share"></i> Share
                                    </button>
                                    <button class="action-btn" onclick="downloadVideo()">
                                        <i class="fas fa-download"></i> Save
                                    </button>
                                </div>
                            </div>
                            <div class="video-description" id="mainVideoDescription">
                                Learn the fundamentals of derivatives in calculus with practical examples. This video covers basic derivative rules, chain rule, and applications in real-world problems. Perfect for Mathematics 101 students.
                            </div>
                        </div>
                    </div>

                    <!-- Recommended Videos Grid (EXACT YouTube arrangement) -->
                    <div class="videos-grid-container">
                        <h3 style="font-size: 1.1rem; color: var(--dark-color); margin-bottom: 12px;">Recommended Videos</h3>
                        <div class="videos-grid" id="relatedVideosGrid">
                            <!-- Videos arranged exactly like YouTube -->
                        </div>
                    </div>
                </div>

                <!-- Sidebar (Up Next & Notes) -->
                <div class="video-sidebar">
                    <!-- Up Next Section -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Up Next</h3>
                        <div class="video-list" id="upNextVideos">
                            <!-- Up next videos in small YouTube format -->
                        </div>
                    </div>

                    <!-- Course Notes Section -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Course Notes</h3>
                        <div class="sidebar-notes-grid" id="sidebarNotes">
                            <!-- Notes will load here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- All Videos Tab -->
    <div id="videos-tab" class="tab-content">
        <section class="content-section">
            <h2 style="font-size: 1.3rem; margin-bottom: 16px; color: var(--dark-color);">
                <i class="fas fa-play-circle"></i> All Videos
            </h2>
            <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 0.9rem;">
                Browse all educational videos uploaded by everyone in your classes.
            </p>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <div class="search-box">
                        <input type="text" id="searchVideos" class="form-control" placeholder="Search videos...">
                    </div>
                    <select id="filterCourseVideos" class="select-control">
                        <option value="">All Courses</option>
                        <option value="math101">Mathematics 101</option>
                        <option value="physics201">Physics 201</option>
                        <option value="cs301">Computer Science 301</option>
                        <option value="english101">English Literature 101</option>
                    </select>
                    <button class="btn btn-primary" onclick="window.location.href='/upload?type=video'">
                        <i class="fas fa-plus"></i> Upload
                    </button>
                </div>
            </div>

            <!-- YouTube-style Videos Grid (EXACT YouTube arrangement) -->
            <div class="videos-grid" id="allVideosGrid">
                <!-- All videos arranged exactly like YouTube -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="videosEmpty" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-video-slash"></i>
                </div>
                <h3 class="empty-title">No Videos Found</h3>
                <p class="empty-text">No videos have been uploaded yet. Start by uploading educational videos!</p>
                <button class="btn btn-primary" onclick="window.location.href='/upload?type=video'">
                    <i class="fas fa-cloud-upload-alt"></i> Upload Video
                </button>
            </div>
        </section>
    </div>

    <!-- All Notes Tab -->
    <div id="notes-tab" class="tab-content">
        <section class="content-section">
            <h2 style="font-size: 1.3rem; margin-bottom: 16px; color: var(--dark-color);">
                <i class="fas fa-file-alt"></i> All Notes
            </h2>
            <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 0.9rem;">
                Browse all course notes, summaries, and study materials.
            </p>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <div class="search-box">
                        <input type="text" id="searchNotes" class="form-control" placeholder="Search notes...">
                    </div>
                    <select id="filterCourseNotes" class="select-control">
                        <option value="">All Courses</option>
                        <option value="math101">Mathematics 101</option>
                        <option value="physics201">Physics 201</option>
                        <option value="cs301">Computer Science 301</option>
                        <option value="english101">English Literature 101</option>
                    </select>
                    <button class="btn btn-primary" onclick="window.location.href='/upload?type=note'">
                        <i class="fas fa-plus"></i> Upload
                    </button>
                </div>
            </div>

            <!-- Notes Grid -->
            <div class="notes-grid" id="allNotesGrid">
                <!-- All notes will be loaded here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="notesEmpty" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 class="empty-title">No Notes Found</h3>
                <p class="empty-text">No notes have been uploaded yet. Start by sharing your study materials!</p>
                <button class="btn btn-primary" onclick="window.location.href='/upload?type=note'">
                    <i class="fas fa-cloud-upload-alt"></i> Upload Notes
                </button>
            </div>
        </section>
    </div>

    <!-- Courses Tab -->
    <div id="courses-tab" class="tab-content">
        <section class="content-section">
            <h2 style="font-size: 1.3rem; margin-bottom: 16px; color: var(--dark-color);">
                <i class="fas fa-graduation-cap"></i> All Courses
            </h2>
            <p style="color: var(--gray-600); margin-bottom: 20px; font-size: 0.9rem;">
                View videos and notes organized by course.
            </p>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <div class="search-box">
                        <input type="text" id="courseSearch" class="form-control" placeholder="Search courses...">
                    </div>
                    <button class="btn btn-outline" onclick="refreshContent()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Courses Grid -->
            <div class="notes-grid" id="coursesGrid">
                <!-- Course cards will be loaded here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="coursesEmpty" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h3 class="empty-title">No Courses Available</h3>
                <p class="empty-text">No courses have been created yet.</p>
            </div>
        </section>
    </div>
</div>

<script>
    // Data storage
    let allUploads = [];
    let uploadedCourses = new Set(); // Store unique uploaded courses
    let currentUser = "{{ firstname }} {{ lastname }}" || "John Doe";
    let currentVideoId = null;

    // Course data - will be populated from uploaded resources
    const courseData = {};

    // Initialize the page
    function initializePage() {
        loadFilesFromStorage();
        extractCoursesFromUploads(); // Extract courses from uploaded resources
        loadHomePage();
        loadAllVideos();
        loadAllNotes();
        loadCourses();
        setupEventListeners();
    }

    // Load files from localStorage
    function loadFilesFromStorage() {
        // First load from eschool_resources (your uploaded files)
        const savedResources = localStorage.getItem('eschool_resources');
        let uploadedResources = [];
        
        if (savedResources) {
            try {
                uploadedResources = JSON.parse(savedResources);
                console.log('Loaded uploaded resources:', uploadedResources.length);
                
                // Convert uploaded resources to our format
                allUploads = uploadedResources.map(resource => {
                    const course = resource.category || 'general';
                    const isVideo = resource.fileCategory === 'video' || resource.type === 'video';
                    const isNote = resource.fileCategory === 'pdf' || resource.fileCategory === 'doc' || resource.type === 'note';
                    
                    // Extract course from resource
                    if (course && course !== 'general') {
                        uploadedCourses.add(course);
                    }
                    
                    if (isVideo) {
                        return {
                            id: resource.id || Date.now(),
                            title: resource.title,
                            course: course,
                            date: resource.uploadDate ? new Date(resource.uploadDate).toLocaleDateString() : 'Recently',
                            views: resource.views || Math.floor(Math.random() * 1000) + 100,
                            duration: resource.duration || '15:00',
                            owner: resource.author || 'Unknown',
                            description: resource.description,
                            thumbnail: getVideoThumbnail(resource),
                            videoId: generateVideoId(resource),
                            type: 'video',
                            likes: Math.floor(Math.random() * 100) + 20,
                            privacy: resource.privacy || 'class',
                            fileData: resource.fileData,
                            fileName: resource.fileName
                        };
                    } else if (isNote) {
                        return {
                            id: resource.id || Date.now(),
                            title: resource.title,
                            course: course,
                            date: resource.uploadDate ? new Date(resource.uploadDate).toLocaleDateString() : 'Recently',
                            pages: resource.pages || Math.floor(Math.random() * 30) + 5,
                            owner: resource.author || 'Unknown',
                            description: resource.description,
                            type: 'note',
                            privacy: resource.privacy || 'class',
                            fileData: resource.fileData,
                            fileName: resource.fileName
                        };
                    }
                    return null;
                }).filter(item => item !== null);
                
            } catch (e) {
                console.error('Error loading uploaded resources:', e);
            }
        }
        
        // If no uploads, add sample data
        if (allUploads.length === 0) {
            loadSampleData();
        }
        
        console.log('Total uploads:', allUploads.length);
        console.log('Uploaded courses:', Array.from(uploadedCourses));
    }

    // Extract courses from uploaded resources and build courseData
    function extractCoursesFromUploads() {
        // Clear existing course data
        Object.keys(courseData).forEach(key => delete courseData[key]);
        uploadedCourses.clear();
        
        // Collect unique courses from uploads
        allUploads.forEach(item => {
            if (item.course && item.course !== 'general') {
                uploadedCourses.add(item.course);
            }
        });
        
        // Build courseData from uploaded courses
        Array.from(uploadedCourses).forEach((course, index) => {
            // Get course details from uploads
            const courseItems = allUploads.filter(item => item.course === course);
            const firstVideo = courseItems.find(item => item.type === 'video');
            const firstNote = courseItems.find(item => item.type === 'note');
            
            // Course colors
            const colors = ['#4361ee', '#ff6b6b', '#1dd1a1', '#feca57', '#5f27cd', '#ff9f43', '#48dbfb', '#ff6b9d'];
            const icons = ['fa-book-open', 'fa-calculator', 'fa-atom', 'fa-laptop-code', 'fa-flask', 'fa-globe', 'fa-paint-brush', 'fa-music'];
            
            courseData[course] = {
                name: formatCourseName(course),
                code: course.toUpperCase(),
                instructor: firstVideo?.owner || firstNote?.owner || 'Various Instructors',
                icon: icons[index % icons.length],
                color: colors[index % colors.length],
                description: getCourseDescription(course, courseItems),
                videoCount: courseItems.filter(item => item.type === 'video').length,
                noteCount: courseItems.filter(item => item.type === 'note').length
            };
        });
        
        console.log('Course data built:', courseData);
    }

    // Helper function to format course name
    function formatCourseName(courseKey) {
        if (!courseKey) return 'General';
        
        // Convert snake_case or kebab-case to Title Case
        return courseKey
            .split(/[_-]/)
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
    }

    // Helper function to generate course description
    function getCourseDescription(course, items) {
        const videoCount = items.filter(item => item.type === 'video').length;
        const noteCount = items.filter(item => item.type === 'note').length;
        
        if (videoCount > 0 && noteCount > 0) {
            return `${videoCount} video${videoCount !== 1 ? 's' : ''} and ${noteCount} note${noteCount !== 1 ? 's' : ''} available`;
        } else if (videoCount > 0) {
            return `${videoCount} video${videoCount !== 1 ? 's' : ''} available`;
        } else if (noteCount > 0) {
            return `${noteCount} note${noteCount !== 1 ? 's' : ''} available`;
        }
        return 'No content yet';
    }

    // Get video thumbnail for uploaded videos
    function getVideoThumbnail(resource) {
        if (resource.thumbnail) return resource.thumbnail;
        
        // Default thumbnails based on category
        const thumbnails = {
            mathematics: 'https://images.unsplash.com/photo-1509228468518-180dd4864904?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            science: 'https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            programming: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            business: 'https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            arts: 'https://images.unsplash.com/photo-1545239351-ef35f43d514b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            languages: 'https://images.unsplash.com/photo-1516321497487-e288fb19713f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            general: 'https://images.unsplash.com/photo-1551989137-294a2c6a2c2b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'
        };
        
        return thumbnails[resource.category] || thumbnails.general;
    }

    // Generate video ID for YouTube embed (for sample data)
    function generateVideoId(resource) {
        if (resource.videoId) return resource.videoId;
        
        // For uploaded videos without YouTube ID, use a placeholder
        const videoIds = ['rygBYwF_4Bc', 'kKKM8Y-u7ds', 'njTh_OwMljA', 'BLtQaRrHsxI', '7zvD-h27t1I'];
        return videoIds[Math.floor(Math.random() * videoIds.length)];
    }

    // Load sample data if no uploads
    function loadSampleData() {
        console.log('Loading sample data...');
        
        // Add sample courses to uploadedCourses
        const sampleCourses = ['mathematics', 'science', 'programming', 'business'];
        sampleCourses.forEach(course => uploadedCourses.add(course));
        
        // Sample video data
        const sampleVideos = [
            {
                id: 1,
                title: 'Calculus Basics: Derivatives Explained',
                course: 'mathematics',
                date: '2 days ago',
                views: '1.2K',
                duration: '15:42',
                owner: 'Dr. Smith',
                description: 'Learn the fundamentals of derivatives in calculus with practical examples.',
                thumbnail: 'https://img.youtube.com/vi/rygBYwF_4Bc/hqdefault.jpg',
                videoId: 'rygBYwF_4Bc',
                type: 'video',
                likes: 45,
                privacy: 'class'
            },
            {
                id: 2,
                title: "Newton's Laws of Motion",
                course: 'science',
                date: '1 week ago',
                views: '2.3K',
                duration: '22:18',
                owner: 'Prof. Johnson',
                description: 'Understanding Newton\'s three laws of motion with demonstrations.',
                thumbnail: 'https://img.youtube.com/vi/kKKM8Y-u7ds/hqdefault.jpg',
                videoId: 'kKKM8Y-u7ds',
                type: 'video',
                likes: 78,
                privacy: 'class'
            }
        ];
        
        // Sample notes data
        const sampleNotes = [
            {
                id: 101,
                title: 'Calculus Formulas & Theorems',
                course: 'mathematics',
                date: '3 days ago',
                pages: 12,
                owner: 'Dr. Smith',
                description: 'Complete collection of all important calculus formulas, theorems, and proofs.',
                type: 'note',
                privacy: 'class'
            },
            {
                id: 102,
                title: 'Quantum Mechanics Notes',
                course: 'science',
                date: '1 week ago',
                pages: 24,
                owner: 'Prof. Johnson',
                description: 'Detailed notes on quantum mechanics principles and equations.',
                type: 'note',
                privacy: 'class'
            }
        ];
        
        allUploads = [...sampleVideos, ...sampleNotes];
        saveFilesToStorage();
    }

    // Setup event listeners
    function setupEventListeners() {
        document.getElementById('searchVideos').addEventListener('input', filterVideos);
        document.getElementById('filterCourseVideos').addEventListener('change', filterVideos);
        document.getElementById('searchNotes').addEventListener('input', filterNotes);
        document.getElementById('filterCourseNotes').addEventListener('change', filterNotes);
        document.getElementById('courseSearch').addEventListener('input', filterCourses);
    }

    // Load home page content
    function loadHomePage() {
        // Get the first uploaded video or use a default
        const videos = allUploads.filter(item => item.type === 'video');
        
        if (videos.length > 0) {
            const defaultVideo = videos[0];
            playVideoInPage(defaultVideo);
        } else {
            // No videos uploaded, show placeholder
            showVideoPlaceholder();
        }
        
        // Load related videos
        loadRelatedVideos(defaultVideo);
        
        // Load up next videos
        loadUpNextVideos(defaultVideo);
        
        // Load sidebar notes
        if (defaultVideo && defaultVideo.course) {
            loadSidebarNotes(defaultVideo.course);
        }
    }

    // Show video placeholder when no videos are uploaded
    function showVideoPlaceholder() {
        const player = document.getElementById('mainVideoPlayer');
        const title = document.getElementById('mainVideoTitle');
        const stats = document.getElementById('mainVideoStats');
        const description = document.getElementById('mainVideoDescription');
        const likeCount = document.getElementById('likeCount');
        
        player.src = 'https://www.youtube.com/embed/rygBYwF_4Bc';
        title.textContent = 'Welcome to Course Content';
        stats.innerHTML = '<span>No videos uploaded yet</span>';
        description.textContent = 'Upload educational videos to get started. Your videos will appear here.';
        likeCount.textContent = '0';
    }

    // Play video in main player
    function playVideoInPage(video) {
        if (!video) return;
        
        currentVideoId = video.id;
        
        const player = document.getElementById('mainVideoPlayer');
        const title = document.getElementById('mainVideoTitle');
        const stats = document.getElementById('mainVideoStats');
        const description = document.getElementById('mainVideoDescription');
        const likeCount = document.getElementById('likeCount');
        
        // Check if it's an uploaded video with fileData
        if (video.fileData) {
            // For uploaded videos, use the fileData directly
            player.src = video.fileData;
            player.setAttribute('controls', 'true');
        } else {
            // For sample YouTube videos
            player.src = `https://www.youtube.com/embed/${video.videoId}?autoplay=1`;
        }
        
        // Update video info
        title.textContent = video.title;
        const courseName = courseData[video.course]?.name || formatCourseName(video.course);
        stats.innerHTML = `<span>${video.views} views</span><span>•</span><span>${video.date}</span><span>•</span><span>${courseName}</span>`;
        description.textContent = video.description;
        likeCount.textContent = video.likes || 0;
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Reload related content
        loadRelatedVideos(video);
        loadUpNextVideos(video);
        if (video.course) {
            loadSidebarNotes(video.course);
        }
    }

    // Load related videos
    function loadRelatedVideos(currentVideo) {
        const container = document.getElementById('relatedVideosGrid');
        if (!currentVideo) {
            container.innerHTML = '<div class="empty-state">No videos available</div>';
            return;
        }
        
        const relatedVideos = allUploads
            .filter(item => item.type === 'video' && item.id !== currentVideo.id)
            .slice(0, 8);
        
        if (relatedVideos.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: var(--gray-500); padding: 20px;">No related videos found</div>';
        } else {
            container.innerHTML = relatedVideos.map(video => createVideoCard(video)).join('');
        }
    }

    // Load up next videos (small YouTube format)
    function loadUpNextVideos(currentVideo) {
        const container = document.getElementById('upNextVideos');
        if (!currentVideo) {
            container.innerHTML = '<div style="color: var(--gray-500); padding: 10px; text-align: center;">No videos available</div>';
            return;
        }
        
        const upNextVideos = allUploads
            .filter(item => item.type === 'video' && item.id !== currentVideo.id)
            .slice(0, 5);
        
        if (upNextVideos.length === 0) {
            container.innerHTML = '<div style="color: var(--gray-500); padding: 10px; text-align: center;">No more videos</div>';
        } else {
            container.innerHTML = upNextVideos.map(video => createSidebarVideoCard(video)).join('');
        }
    }

    // Load sidebar notes
    function loadSidebarNotes(courseId) {
        const container = document.getElementById('sidebarNotes');
        const notes = allUploads
            .filter(item => item.type === 'note' && item.course === courseId)
            .slice(0, 3);
        
        if (notes.length === 0) {
            container.innerHTML = '<div style="color: var(--gray-500); padding: 10px; text-align: center;">No notes for this course</div>';
        } else {
            container.innerHTML = notes.map(note => createSidebarNoteCard(note)).join('');
        }
    }

    // Load all videos (YouTube grid arrangement)
    function loadAllVideos() {
        const videos = allUploads.filter(item => item.type === 'video');
        const container = document.getElementById('allVideosGrid');
        const emptyState = document.getElementById('videosEmpty');
        
        if (videos.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        container.innerHTML = videos.map(video => createVideoCard(video)).join('');
    }

    // Load all notes
    function loadAllNotes() {
        const notes = allUploads.filter(item => item.type === 'note');
        const container = document.getElementById('allNotesGrid');
        const emptyState = document.getElementById('notesEmpty');
        
        if (notes.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        container.innerHTML = notes.map(note => createNoteCard(note)).join('');
    }

    // Load courses - ONLY SHOW UPLOADED COURSES
    function loadCourses() {
        const container = document.getElementById('coursesGrid');
        const emptyState = document.getElementById('coursesEmpty');
        
        // Get unique courses from uploads
        const uniqueCourses = Array.from(uploadedCourses);
        
        if (uniqueCourses.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        container.innerHTML = uniqueCourses.map(courseId => {
            const course = courseData[courseId] || {
                name: formatCourseName(courseId),
                code: courseId.toUpperCase(),
                instructor: 'Various Instructors',
                icon: 'fa-book-open',
                color: '#4361ee',
                description: 'Course with uploaded content'
            };
            
            const courseVideos = allUploads.filter(item => item.type === 'video' && item.course === courseId);
            const courseNotes = allUploads.filter(item => item.type === 'note' && item.course === courseId);
            
            return `
                <div class="note-card" onclick="viewCoursePage('${courseId}')">
                    <div class="note-header">
                        <div class="note-icon" style="background: ${course.color};">
                            <i class="fas ${course.icon}"></i>
                        </div>
                        <div>
                            <h3 class="note-title">${course.name}</h3>
                            <p class="note-course">${course.instructor}</p>
                        </div>
                    </div>
                    <p class="note-description">${course.description}</p>
                    <div class="note-meta">
                        <span><i class="fas fa-play-circle"></i> ${courseVideos.length} videos</span>
                        <span><i class="fas fa-file-alt"></i> ${courseNotes.length} notes</span>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Create YouTube video card (small measurements)
    function createVideoCard(video) {
        const course = courseData[video.course] || {
            name: formatCourseName(video.course),
            color: '#4361ee'
        };
        
        return `
            <div class="video-card" onclick="playVideoInPage(${JSON.stringify(video).replace(/"/g, '&quot;')})">
                <div class="thumbnail-container">
                    <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail" onerror="this.src='https://images.unsplash.com/photo-1551989137-294a2c6a2c2b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
                    <div class="video-duration">${video.duration || '15:00'}</div>
                </div>
                <div class="video-info-container">
                    <div class="channel-avatar" style="background: ${course.color}">
                        ${course.name ? course.name.charAt(0) : 'C'}
                    </div>
                    <div class="video-details">
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-channel">${course.name || 'General'}</p>
                        <div class="video-stats">
                            <span>${video.views} views</span>
                            <span>•</span>
                            <span>${video.date}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // Create sidebar video card (YouTube small format)
    function createSidebarVideoCard(video) {
        const course = courseData[video.course] || {
            name: formatCourseName(video.course)
        };
        
        return `
            <div class="sidebar-video-card" onclick="playVideoInPage(${JSON.stringify(video).replace(/"/g, '&quot;')})">
                <div class="sidebar-thumbnail">
                    <img src="${video.thumbnail}" alt="${video.title}" onerror="this.src='https://images.unsplash.com/photo-1551989137-294a2c6a2c2b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
                    <div class="sidebar-duration">${video.duration || '15:00'}</div>
                </div>
                <div class="sidebar-video-info">
                    <h4 class="sidebar-video-title">${video.title}</h4>
                    <p class="sidebar-video-channel">${course.name || 'General'}</p>
                    <div class="sidebar-video-stats">
                        <span>${video.views} views • ${video.date}</span>
                    </div>
                </div>
            </div>
        `;
    }

    // Create note card
    function createNoteCard(note) {
        const course = courseData[note.course] || {
            name: formatCourseName(note.course),
            color: '#4361ee'
        };
        
        return `
            <div class="note-card" onclick="viewNote(${note.id})">
                <div class="note-header">
                    <div class="note-icon" style="background: ${course.color};">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div>
                        <h3 class="note-title">${note.title}</h3>
                        <p class="note-course">${course.name || 'General'}</p>
                    </div>
                </div>
                <p class="note-description">${note.description}</p>
                <div class="note-meta">
                    <span>${note.pages || 1} pages</span>
                    <span>${note.date}</span>
                </div>
            </div>
        `;
    }

    // Create sidebar note card
    function createSidebarNoteCard(note) {
        const course = courseData[note.course] || {
            name: formatCourseName(note.course),
            color: '#4361ee'
        };
        
        return `
            <div class="sidebar-note-card" onclick="viewNote(${note.id})">
                <div class="sidebar-note-icon" style="background: ${course.color};">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="sidebar-note-info">
                    <div class="sidebar-note-title">${note.title}</div>
                    <div class="sidebar-note-course">${course.name || 'General'}</div>
                </div>
            </div>
        `;
    }

    // View note
    function viewNote(noteId) {
        const note = allUploads.find(item => item.id === noteId);
        if (!note) return;
        
        // Check if it's an uploaded note with fileData
        if (note.fileData) {
            // Open the uploaded file
            window.open(note.fileData, '_blank');
        } else {
            // For sample notes, show alert
            alert(`Opening: ${note.title}\n\nThis is a sample note. Uploaded PDFs/DOCs would open in a new tab.`);
        }
    }

    // View course page - show only uploaded content for that course
    function viewCoursePage(courseId) {
        const course = courseData[courseId];
        if (!course) return;
        
        // Filter videos and notes for this course
        const courseVideos = allUploads.filter(item => item.type === 'video' && item.course === courseId);
        const courseNotes = allUploads.filter(item => item.type === 'note' && item.course === courseId);
        
        // Show course page content
        alert(`Course: ${course.name}\n\nVideos: ${courseVideos.length}\nNotes: ${courseNotes.length}\n\nThis page would show all content for this course.`);
        
        // You could also implement a modal or new section to show course-specific content
        showCourseModal(courseId);
    }

    // Show course modal with all content
    function showCourseModal(courseId) {
        const course = courseData[courseId];
        const courseVideos = allUploads.filter(item => item.type === 'video' && item.course === courseId);
        const courseNotes = allUploads.filter(item => item.type === 'note' && item.course === courseId);
        
        // Create modal HTML
        const modalHTML = `
            <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                <div style="background: white; border-radius: 12px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto;">
                    <div style="padding: 24px; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="color: var(--dark-color); font-size: 1.5rem; margin-bottom: 8px;">${course.name}</h2>
                            <p style="color: var(--gray-600); font-size: 0.9rem;">${course.description}</p>
                        </div>
                        <button onclick="closeCourseModal()" style="background: none; border: none; font-size: 1.5rem; color: var(--gray-500); cursor: pointer;">×</button>
                    </div>
                    
                    <div style="padding: 24px;">
                        ${courseVideos.length > 0 ? `
                        <h3 style="color: var(--dark-color); margin-bottom: 16px; font-size: 1.2rem;">
                            <i class="fas fa-play-circle"></i> Videos (${courseVideos.length})
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                            ${courseVideos.map(video => `
                                <div onclick="playVideoInPage(${JSON.stringify(video).replace(/"/g, '&quot;')}); closeCourseModal();" style="cursor: pointer;">
                                    <div style="position: relative; width: 100%; aspect-ratio: 16/9; border-radius: 8px; overflow: hidden; margin-bottom: 8px;">
                                        <img src="${video.thumbnail}" alt="${video.title}" style="width: 100%; height: 100%; object-fit: cover;">
                                        <div style="position: absolute; bottom: 4px; right: 4px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 2px; font-size: 11px;">${video.duration}</div>
                                    </div>
                                    <h4 style="font-size: 14px; font-weight: 500; color: var(--gray-800); margin-bottom: 4px;">${video.title}</h4>
                                    <p style="font-size: 12px; color: var(--gray-600);">${video.date} • ${video.views} views</p>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${courseNotes.length > 0 ? `
                        <h3 style="color: var(--dark-color); margin-bottom: 16px; font-size: 1.2rem;">
                            <i class="fas fa-file-alt"></i> Notes (${courseNotes.length})
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px;">
                            ${courseNotes.map(note => `
                                <div onclick="viewNote(${note.id}); closeCourseModal();" style="background: var(--gray-50); padding: 16px; border-radius: 8px; cursor: pointer; border-left: 3px solid ${course.color};">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                        <div style="width: 40px; height: 40px; border-radius: 6px; background: ${course.color}; display: flex; align-items: center; justify-content: center; color: white;">
                                            <i class="fas fa-file-pdf"></i>
                                        </div>
                                        <div>
                                            <h4 style="font-size: 14px; font-weight: 500; color: var(--gray-800); margin-bottom: 4px;">${note.title}</h4>
                                            <p style="font-size: 12px; color: var(--gray-600);">${note.pages} pages</p>
                                        </div>
                                    </div>
                                    <p style="font-size: 12px; color: var(--gray-600); margin: 0;">${note.description}</p>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${courseVideos.length === 0 && courseNotes.length === 0 ? `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-folder-open" style="font-size: 3rem; color: var(--gray-300); margin-bottom: 16px;"></i>
                            <h3 style="color: var(--gray-600); margin-bottom: 8px;">No Content Yet</h3>
                            <p style="color: var(--gray-500); margin-bottom: 20px;">No videos or notes have been uploaded for this course.</p>
                            <button onclick="window.location.href='/upload'" style="background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                                <i class="fas fa-cloud-upload-alt"></i>
                                Upload Content
                            </button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
        
        // Create and show modal
        const modal = document.createElement('div');
        modal.innerHTML = modalHTML;
        modal.id = 'courseModal';
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
    }

    // Close course modal
    function closeCourseModal() {
        const modal = document.getElementById('courseModal');
        if (modal) {
            document.body.removeChild(modal);
            document.body.style.overflow = '';
        }
    }

    // Like video
    function likeVideo() {
        if (!currentVideoId) return;
        
        const video = allUploads.find(item => item.id === currentVideoId);
        if (video) {
            video.likes = (video.likes || 0) + 1;
            saveFilesToStorage();
            
            const likeCount = document.getElementById('likeCount');
            likeCount.textContent = video.likes;
            
            // Show brief feedback
            const likeBtn = document.querySelector('.action-btn.like');
            likeBtn.innerHTML = `<i class="fas fa-thumbs-up"></i> <span id="likeCount">${video.likes}</span>`;
            likeBtn.style.background = 'var(--primary-light)';
            likeBtn.style.color = 'var(--primary-color)';
            
            setTimeout(() => {
                likeBtn.style.background = '';
                likeBtn.style.color = '';
            }, 1000);
        }
    }

    // Share video
    function shareVideo() {
        if (!currentVideoId) return;
        
        const video = allUploads.find(item => item.id === currentVideoId);
        if (video) {
            const shareUrl = `${window.location.origin}/video/${video.videoId}`;
            if (navigator.share) {
                navigator.share({
                    title: video.title,
                    text: 'Check out this educational video: ' + video.title,
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(shareUrl)
                    .then(() => alert('Video link copied to clipboard!'))
                    .catch(() => alert(`Share this link: ${shareUrl}`));
            }
        }
    }

    // Download video
    function downloadVideo() {
        if (!currentVideoId) return;
        
        const video = allUploads.find(item => item.id === currentVideoId);
        if (video) {
            if (video.fileData) {
                // For uploaded videos
                const a = document.createElement('a');
                a.href = video.fileData;
                a.download = video.fileName || video.title + '.mp4';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } else {
                // For sample videos
                alert(`Downloading: ${video.title}\n\nThis is a sample video. Uploaded videos can be downloaded directly.`);
            }
        }
    }

    // Save files to localStorage
    function saveFilesToStorage() {
        localStorage.setItem('eschool_uploads', JSON.stringify(allUploads));
    }

    // Switch main tabs
    function switchMainTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.main-tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    // Filter videos
    function filterVideos() {
        const searchTerm = document.getElementById('searchVideos').value.toLowerCase();
        const courseFilter = document.getElementById('filterCourseVideos').value;
        
        const videos = allUploads.filter(item => item.type === 'video');
        const filteredVideos = videos.filter(video => {
            let match = true;
            
            if (searchTerm) {
                const searchIn = `${video.title} ${video.description} ${video.owner}`.toLowerCase();
                if (!searchIn.includes(searchTerm)) match = false;
            }
            
            if (courseFilter && video.course !== courseFilter) {
                match = false;
            }
            
            return match;
        });
        
        const container = document.getElementById('allVideosGrid');
        const emptyState = document.getElementById('videosEmpty');
        
        if (filteredVideos.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
        } else {
            emptyState.style.display = 'none';
            container.innerHTML = filteredVideos.map(video => createVideoCard(video)).join('');
        }
    }

    // Filter notes
    function filterNotes() {
        const searchTerm = document.getElementById('searchNotes').value.toLowerCase();
        const courseFilter = document.getElementById('filterCourseNotes').value;
        
        const notes = allUploads.filter(item => item.type === 'note');
        const filteredNotes = notes.filter(note => {
            let match = true;
            
            if (searchTerm) {
                const searchIn = `${note.title} ${note.description} ${note.owner}`.toLowerCase();
                if (!searchIn.includes(searchTerm)) match = false;
            }
            
            if (courseFilter && note.course !== courseFilter) {
                match = false;
            }
            
            return match;
        });
        
        const container = document.getElementById('allNotesGrid');
        const emptyState = document.getElementById('notesEmpty');
        
        if (filteredNotes.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
        } else {
            emptyState.style.display = 'none';
            container.innerHTML = filteredNotes.map(note => createNoteCard(note)).join('');
        }
    }

    // Filter courses - ONLY SHOW UPLOADED COURSES
    function filterCourses() {
        const searchTerm = document.getElementById('courseSearch').value.toLowerCase();
        
        const filteredCourses = Array.from(uploadedCourses).filter(courseId => {
            const course = courseData[courseId] || { name: formatCourseName(courseId), description: '' };
            const searchIn = `${course.name} ${course.instructor} ${course.description}`.toLowerCase();
            return searchIn.includes(searchTerm);
        });
        
        const container = document.getElementById('coursesGrid');
        const emptyState = document.getElementById('coursesEmpty');
        
        container.innerHTML = filteredCourses.map(courseId => {
            const course = courseData[courseId] || {
                name: formatCourseName(courseId),
                code: courseId.toUpperCase(),
                instructor: 'Various Instructors',
                icon: 'fa-book-open',
                color: '#4361ee',
                description: 'Course with uploaded content'
            };
            
            const courseVideos = allUploads.filter(item => item.type === 'video' && item.course === courseId);
            const courseNotes = allUploads.filter(item => item.type === 'note' && item.course === courseId);
            
            return `
                <div class="note-card" onclick="viewCoursePage('${courseId}')">
                    <div class="note-header">
                        <div class="note-icon" style="background: ${course.color};">
                            <i class="fas ${course.icon}"></i>
                        </div>
                        <div>
                            <h3 class="note-title">${course.name}</h3>
                            <p class="note-course">${course.instructor}</p>
                        </div>
                    </div>
                    <p class="note-description">${course.description}</p>
                    <div class="note-meta">
                        <span><i class="fas fa-play-circle"></i> ${courseVideos.length} videos</span>
                        <span><i class="fas fa-file-alt"></i> ${courseNotes.length} notes</span>
                    </div>
                </div>
            `;
        }).join('');
        
        emptyState.style.display = filteredCourses.length === 0 ? 'block' : 'none';
    }

    // Refresh content
    function refreshContent() {
        loadFilesFromStorage();
        extractCoursesFromUploads();
        loadHomePage();
        loadAllVideos();
        loadAllNotes();
        loadCourses();
        alert('Content refreshed with latest uploads!');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', initializePage);
</script>
{% endblock %}