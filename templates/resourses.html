{% extends "body.html" %}

{% block allcontent %}
<style>
    :root {
        --primary-color: #4361ee;
        --primary-light: #e0e7ff;
        --secondary-color: #3a0ca3;
        --accent-color: #4cc9f0;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --light-color: #f8fafc;
        --dark-color: #1e293b;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --border-radius: 12px;
        --border-radius-sm: 8px;
        --card-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Main Layout */
    .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Resources Header */
    .resources-header {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 40px 20px;
        margin-bottom: 30px;
        border-radius: var(--border-radius);
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
    }

    .header-content {
        position: relative;
        z-index: 2;
        text-align: center;
    }

    .page-icon {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 2.5rem;
        backdrop-filter: blur(5px);
    }

    .page-title {
        font-family: 'Poppins', sans-serif;
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .page-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto 20px;
    }

    .stats-container {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 20px;
        flex-wrap: wrap;
        display: none;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.2);
        padding: 15px 25px;
        border-radius: 12px;
        backdrop-filter: blur(5px);
        min-width: 120px;
        text-align: center;
        transition: var(--transition);
        display: none;
    }

    .stat-card:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-5px);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }

    /* Main Tabs */
    .main-tabs {
        display: flex;
        background: white;
        border-radius: 8px;
        margin-bottom: 30px;
        overflow-x: auto;
        box-shadow: var(--card-shadow);
        padding: 4px;
        border: 1px solid var(--gray-200);
    }

    .main-tab-btn {
        padding: 12px 20px;
        border: none;
        background: none;
        cursor: pointer;
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        font-weight: 500;
        color: var(--gray-600);
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 6px;
        margin: 0 2px;
        white-space: nowrap;
    }

    .main-tab-btn:hover {
        background: var(--gray-100);
    }

    .main-tab-btn.active {
        background: var(--primary-color);
        color: white;
        box-shadow: 0 2px 8px rgba(67, 97, 238, 0.2);
    }

    /* Filter Bar */
    .filter-bar {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        border: 1px solid var(--gray-200);
    }

    .filter-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
    }

    .search-box {
        flex: 1;
        min-width: 250px;
    }

    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 25px;
        font-size: 0.95rem;
        font-family: 'Inter', sans-serif;
        transition: var(--transition);
        background: var(--gray-50);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    .select-control {
        padding: 10px 16px;
        border: 2px solid var(--gray-200);
        border-radius: 25px;
        font-size: 0.95rem;
        background: var(--gray-50);
        cursor: pointer;
        min-width: 150px;
        transition: var(--transition);
    }

    .select-control:focus {
        outline: none;
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    /* Content Grids */
    .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    /* Resource Cards */
    .resource-card {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--card-shadow);
        transition: var(--transition);
        cursor: pointer;
        height: 100%;
        display: flex;
        flex-direction: column;
        border: 1px solid var(--gray-200);
    }

    .resource-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        border-color: var(--primary-color);
    }

    .resource-thumbnail {
        position: relative;
        width: 100%;
        aspect-ratio: 16/9;
        overflow: hidden;
        background: var(--gray-100);
    }

    .resource-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .resource-card:hover .resource-thumbnail img {
        transform: scale(1.05);
    }

    .resource-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--primary-color);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        backdrop-filter: blur(4px);
        background: rgba(67, 97, 238, 0.9);
    }

    .resource-badge.large {
        background: rgba(245, 158, 11, 0.9);
    }

    .resource-duration {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .play-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .resource-card:hover .play-overlay {
        opacity: 1;
    }

    .resource-content {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .resource-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 10px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .resource-description {
        color: var(--gray-600);
        font-size: 0.9rem;
        margin-bottom: 15px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex: 1;
    }

    .resource-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
        padding-top: 15px;
        border-top: 1px solid var(--gray-200);
    }

    .resource-category {
        background: var(--primary-light);
        color: var(--primary-color);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .resource-stats {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--gray-500);
        font-size: 0.8rem;
    }

    .resource-stats i {
        margin-right: 3px;
    }

    /* File Preview Modal */
    .preview-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        padding: 20px;
        overflow-y: auto;
    }

    .preview-content {
        background: white;
        max-width: 900px;
        margin: 50px auto;
        border-radius: var(--border-radius);
        overflow: hidden;
        position: relative;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .preview-header {
        padding: 20px;
        background: var(--dark-color);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .preview-header h2 {
        margin: 0;
        font-size: 1.5rem;
        flex: 1;
        margin-right: 20px;
    }

    .close-preview {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }

    .close-preview:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .preview-body {
        padding: 30px;
    }

    /* Video Player */
    .video-preview {
        width: 100%;
        aspect-ratio: 16/9;
        background: #000;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 20px;
    }

    .video-preview video {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    /* Document Preview */
    .document-preview {
        width: 100%;
        min-height: 400px;
        background: var(--gray-50);
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 2px dashed var(--gray-300);
    }

    .document-preview i {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 20px;
    }

    /* Large File Warning */
    .large-file-warning {
        background: var(--warning-color);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
    }

    /* Download Button */
    .download-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--primary-color);
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: var(--transition);
        border: none;
        cursor: pointer;
    }

    .download-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin-bottom: 30px;
        border: 2px dashed var(--gray-300);
    }

    .empty-icon {
        width: 100px;
        height: 100px;
        background: var(--gray-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 3rem;
        color: var(--gray-400);
    }

    .empty-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.5rem;
        color: var(--gray-600);
        margin-bottom: 10px;
    }

    .empty-text {
        color: var(--gray-500);
        max-width: 500px;
        margin: 0 auto 30px;
        font-size: 1rem;
        line-height: 1.5;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn {
        padding: 12px 24px;
        border-radius: 25px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-family: 'Inter', sans-serif;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.2);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
    }

    .btn-secondary {
        background: var(--gray-100);
        color: var(--gray-700);
        border: 1px solid var(--gray-300);
    }

    .btn-secondary:hover {
        background: var(--gray-200);
    }

    /* File Type Colors */
    .file-type-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-right: 8px;
    }

    .badge-video { background: #ff6b6b; color: white; }
    .badge-pdf { background: #ff9f43; color: white; }
    .badge-doc { background: #48dbfb; color: white; }
    .badge-image { background: #1dd1a1; color: white; }
    .badge-zip { background: #f368e0; color: white; }
    .badge-code { background: #54a0ff; color: white; }
    .badge-audio { background: #5f27cd; color: white; }
    .badge-other { background: #8395a7; color: white; }

    /* Quick Stats */
    .quick-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .stat-item {
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: var(--transition);
        border: 1px solid var(--gray-200);
    }

    .stat-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .icon-video { background: #ff6b6b; }
    .icon-doc { background: #48dbfb; }
    .icon-image { background: #1dd1a1; }
    .icon-audio { background: #5f27cd; }
    .icon-other { background: #8395a7; }

    .stat-info h3 {
        margin: 0 0 5px 0;
        font-size: 1.8rem;
        color: var(--dark-color);
    }

    .stat-info p {
        margin: 0;
        color: var(--gray-600);
        font-size: 0.9rem;
    }

    /* User Badge */
    .user-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        background: var(--primary-light);
        color: var(--primary-color);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        margin-left: 10px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .content-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .quick-stats {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .filter-group {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-box, .select-control {
            width: 100%;
        }
        
        .page-title {
            font-size: 2rem;
        }
        
        .stats-container {
            gap: 15px;
        }
        
        .stat-card {
            min-width: 100px;
            padding: 12px 15px;
        }
        
        .preview-body {
            padding: 15px;
        }
    }

    @media (max-width: 480px) {
        .content-grid {
            grid-template-columns: 1fr;
        }
        
        .quick-stats {
            grid-template-columns: 1fr;
        }
        
        .main-tabs {
            flex-direction: column;
        }
        
        .main-tab-btn {
            justify-content: center;
        }
        
        .preview-content {
            margin: 20px auto;
        }
    }

    /* Loading Spinner */
    .loading-spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #4361ee;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 50px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Notification */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 1001;
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .notification.show {
        transform: translateX(0);
        opacity: 1;
    }

    .notification.success {
        background: #10b981;
    }

    .notification.error {
        background: #ef4444;
    }

    .notification.info {
        background: #4361ee;
    }

    /* File preview actions */
    .file-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    /* File details */
    .file-details {
        background: var(--gray-50);
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
    }

    .file-details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .detail-label {
        font-size: 0.85rem;
        color: var(--gray-600);
        font-weight: 500;
    }

    .detail-value {
        font-weight: 600;
        color: var(--gray-800);
    }
</style>

<div class="main-container">
    <!-- Resources Header -->
    <header class="resources-header">
        <div class="header-content">
            <div class="page-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <h1 class="page-title">All Uploaded Resources</h1>
            <p class="page-subtitle">Access all educational materials shared by everyone in your classes. Watch videos, view images, and download files directly.</p>
            
            
        </div>
    </header>



    <!-- Main Tabs -->
   <div class="main-tabs">
    <button class="main-tab-btn active" onclick="switchTab('all', this)" data-tab="all">
        <i class="fas fa-th-large"></i> All Resources
    </button>
    <button class="main-tab-btn" onclick="switchTab('videos', this)" data-tab="videos">
        <i class="fas fa-play-circle"></i> Videos
    </button>
    <button class="main-tab-btn" onclick="switchTab('documents', this)" data-tab="documents">
        <i class="fas fa-file-alt"></i> Documents
    </button>
    <button class="main-tab-btn" onclick="switchTab('images', this)" data-tab="images">
        <i class="fas fa-image"></i> Images
    </button>
    <button class="main-tab-btn" onclick="switchTab('audio', this)" data-tab="audio">
        <i class="fas fa-music"></i> Audio
    </button>
    <button class="main-tab-btn" onclick="switchTab('other', this)" data-tab="other">
        <i class="fas fa-file"></i> Other Files
    </button>
    <button class="main-tab-btn" onclick="window.location.href='/upload'" style="margin-left: auto;">
        <i class="fas fa-cloud-upload-alt"></i> Upload New
    </button>
</div>


    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="filter-group">
            <div class="search-box">
                <input type="text" id="searchInput" class="form-control" placeholder="Search resources by title, description, or author...">
            </div>
            <select id="courseFilter" class="select-control">
                <option value="">All Courses</option>
                <option value="mathematics">Mathematics</option>
                <option value="science">Science</option>
                <option value="programming">Programming</option>
                <option value="business">Business</option>
                <option value="arts">Arts & Humanities</option>
                <option value="languages">Languages</option>
                <option value="general">General</option>
            </select>
            <select id="sortFilter" class="select-control">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
                <option value="largest">Largest Files</option>
                <option value="smallest">Smallest Files</option>
                <option value="popular">Most Popular</option>
            </select>
            <button class="btn btn-primary" onclick="refreshResources()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>
    </div>

    <!-- Resources Grid -->
    <div class="content-grid" id="resourcesGrid">
        <!-- Resources will be loaded here -->
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;"></div>

    <!-- Empty State -->
    <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">
            <i class="fas fa-folder-open"></i>
        </div>
        <h3 class="empty-title">No Resources Found</h3>
        <p class="empty-text">No resources have been uploaded yet. Be the first to share educational materials!</p>
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="window.location.href='/upload'">
                <i class="fas fa-cloud-upload-alt"></i> Upload Resources
            </button>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-content" id="previewContent">
            <!-- Preview content will be loaded here -->
        </div>
    </div>
</div>

<script>
    // =========================
    // Global Variables
    // =========================
    let allResources = [];
    let currentUser = "{{ firstname }} {{ lastname }}" || "John Doe";
    let currentUserId = "{{ user_id }}" || null;
    let currentPreviewResource = null;

    // =========================
    // Initialization
    // =========================
    document.addEventListener('DOMContentLoaded', () => {
        createNotificationContainer();
        setupEventListeners();
        loadAllResources();
    });

    // =========================
    // Notification Container
    // =========================
    function createNotificationContainer() {
        const container = document.createElement('div');
        container.id = 'notificationContainer';
        document.body.appendChild(container);
    }

    function showNotification(message, type='info') {
        const container = document.getElementById('notificationContainer');
        if (!container) return;
        const notif = document.createElement('div');
        notif.className = `notification ${type}`;
        notif.textContent = message;
        container.appendChild(notif);
        setTimeout(() => notif.remove(), 3000);
    }

    // =========================
    // Loading Spinner
    // =========================
    function showLoading(show) {
        const spinner = document.getElementById('loadingSpinner');
        const grid = document.getElementById('resourcesGrid');
        if (!spinner || !grid) return;
        if (show) {
            spinner.style.display = 'block';
            grid.innerHTML = '';
        } else {
            spinner.style.display = 'none';
        }
    }

    // =========================
    // Event Listeners
    // =========================
    function setupEventListeners() {
        const searchInput = document.getElementById('searchInput');
        const courseFilter = document.getElementById('courseFilter');
        const sortFilter = document.getElementById('sortFilter');

        if (searchInput) searchInput.addEventListener('input', filterResources);
        if (courseFilter) courseFilter.addEventListener('change', filterResources);
        if (sortFilter) sortFilter.addEventListener('change', filterResources);

        // Close preview modal on click outside
        const previewModal = document.getElementById('previewModal');
        if (previewModal) {
            previewModal.addEventListener('click', e => {
                if (e.target.id === 'previewModal') closePreview();
            });
        }

        // Close modal with Escape key
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closePreview();
        });
    }

    // =========================
    // Load All Resources
    // =========================
    async function loadAllResources() {
        try {
            showLoading(true);
            const response = await fetch('/api/resources');
            const result = await response.json();
            if (result.success) {
                allResources = result.resources;
                updateStats();
                renderResources(getActiveTab());
                renderQuickStats();
                showNotification('Resources loaded successfully', 'success');
            } else {
                showNotification('Failed to load resources', 'error');
            }
        } catch (error) {
            console.error(error);
            showNotification('Network error loading resources', 'error');
        } finally {
            showLoading(false);
        }
    }

    // =========================
    // Active Tab
    // =========================
    function getActiveTab() {
        const activeBtn = document.querySelector('.main-tab-btn.active');
        return activeBtn ? activeBtn.dataset.tab : 'all';
    }

    function switchTab(tab, btnElement) {
        document.querySelectorAll('.main-tab-btn').forEach(btn => btn.classList.remove('active'));
        btnElement.classList.add('active');
        renderResources(tab);
    }

    // =========================
    // Filter Resources
    // =========================
    function filterResources() {
        const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
        const courseFilter = document.getElementById('courseFilter')?.value || '';
        const sortFilter = document.getElementById('sortFilter')?.value || 'newest';
        renderResources(getActiveTab(), searchTerm, courseFilter, sortFilter);
    }

    // =========================
    // Render Resources Grid
    // =========================
    function renderResources(tab='all', searchTerm='', courseFilter='', sortFilter='newest') {
        let filtered = [...allResources];

        // Filter by tab
        if (tab === 'videos') filtered = filtered.filter(r => r.file_category === 'video');
        else if (tab === 'documents') filtered = filtered.filter(r => ['pdf','doc','presentation','spreadsheet','code'].includes(r.file_category));
        else if (tab === 'images') filtered = filtered.filter(r => r.file_category === 'image');
        else if (tab === 'audio') filtered = filtered.filter(r => r.file_category === 'audio');
        else if (tab === 'other') filtered = filtered.filter(r => ['other','zip'].includes(r.file_category));

        // Filter by search term
        if (searchTerm) {
            filtered = filtered.filter(r => 
                (r.title && r.title.toLowerCase().includes(searchTerm)) ||
                (r.description && r.description.toLowerCase().includes(searchTerm)) ||
                (r.category && r.category.toLowerCase().includes(searchTerm)) ||
                (r.author && r.author.toLowerCase().includes(searchTerm)) ||
                (r.file_name && r.file_name.toLowerCase().includes(searchTerm))
            );
        }

        // Filter by course
        if (courseFilter) filtered = filtered.filter(r => r.category === courseFilter);

        // Sort
        filtered = sortResources(filtered, sortFilter);

        // Render
        const grid = document.getElementById('resourcesGrid');
        const emptyState = document.getElementById('emptyState');
        if (!grid || !emptyState) return;

        if (filtered.length === 0) {
            grid.innerHTML = '';
            emptyState.style.display = 'block';
        } else {
            emptyState.style.display = 'none';
            grid.innerHTML = filtered.map(createResourceCard).join('');
        }
    }

    // =========================
    // Sort Resources
    // =========================
    function sortResources(resources, sortBy) {
        switch(sortBy) {
            case 'newest': return resources.sort((a,b)=> new Date(b.upload_date)-new Date(a.upload_date));
            case 'oldest': return resources.sort((a,b)=> new Date(a.upload_date)-new Date(b.upload_date));
            case 'largest': return resources.sort((a,b)=> (b.file_size||0)-(a.file_size||0));
            case 'smallest': return resources.sort((a,b)=> (a.file_size||0)-(b.file_size||0));
            case 'popular': return resources.sort((a,b)=> (b.views||0)-(a.views||0));
            default: return resources;
        }
    }

    // =========================
    // Create Resource Card
    // =========================
    function createResourceCard(resource) {
        const icon = getFileIcon(resource.file_category);
        const badgeClass = `badge-${resource.file_category}`;
        const badgeText = getFileTypeText(resource.file_category);
        const fileSize = formatFileSize(resource.file_size || 0);
        const views = resource.views || 0;
        const likes = resource.likes || 0;
        const isMyResource = resource.user_id == currentUserId;
        let thumbnailUrl = resource.thumbnail_url || getDefaultThumbnail(resource.file_category, resource.category);
        if (resource.file_category === 'image' && resource.file_url) thumbnailUrl = resource.file_url;

        const playOverlay = resource.file_category === 'video' && resource.file_url ? `<div class="play-overlay"><i class="fas fa-play"></i> Play Video</div>` : '';

        return `
            <div class="resource-card" onclick="previewResource(${resource.id})">
                <div class="resource-thumbnail">
                    <img src="${thumbnailUrl}" alt="${resource.title}" onerror="this.src='https://images.unsplash.com/photo-1551989137-294a2c6a2c2b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
                    <div class="resource-badge"><i class="fas ${icon}"></i> ${badgeText}</div>
                    ${resource.file_category==='video'?`<div class="resource-duration">${resource.duration || '15:00'}</div>`:''}
                    ${playOverlay}
                </div>
                <div class="resource-content">
                    <h3 class="resource-title">${resource.title}</h3>
                    <p class="resource-description">${resource.description || 'No description provided.'}</p>
                    <div class="resource-meta">
                        <div style="display:flex; gap:8px; align-items:center;">
                            <span class="resource-category">${resource.category || 'General'}</span>
                            ${isMyResource?'<span class="user-badge"><i class="fas fa-user"></i> Yours</span>':''}
                        </div>
                        <div class="resource-stats">
                            <span><i class="fas fa-eye"></i> ${views}</span>
                            <span><i class="fas fa-thumbs-up"></i> ${likes}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // =========================
    // Resource Preview
    // =========================
    async function previewResource(resourceId) {
        try {
            showLoading(true);
            const res = await fetch(`/api/resources/${resourceId}`);
            const result = await res.json();
            if (!result.success) {
                showNotification('Failed to load resource', 'error');
                return;
            }
            const resource = result.resource;
            currentPreviewResource = resource;
            const modal = document.getElementById('previewModal');
            const content = document.getElementById('previewContent');
            if (!modal || !content) return;

            const icon = getFileIcon(resource.file_category);
            const badgeClass = `badge-${resource.file_category}`;
            const badgeText = getFileTypeText(resource.file_category);
            const fileSize = formatFileSize(resource.file_size || 0);
            const uploadDate = new Date(resource.upload_date).toLocaleDateString();
            const views = resource.views || 0;
            const likes = resource.likes || 0;
            const isMyResource = resource.user_id == currentUserId;

            let previewHTML = '';
            if (resource.file_category==='video' && resource.file_url) {
                previewHTML = `<div class="video-preview"><video controls autoplay style="width:100%; height:100%;"><source src="${resource.file_url}" type="video/mp4">Your browser does not support the video tag.</video></div>`;
            } else if (resource.file_category==='image' && resource.file_url) {
                previewHTML = `<div style="text-align:center;"><img src="${resource.file_url}" alt="${resource.title}" style="max-width:100%; max-height:500px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);"></div>`;
            } else {
                previewHTML = `<div class="document-preview"><i class="fas ${icon}" style="font-size:4rem; color:var(--primary-color);"></i><h3>${resource.title}</h3><p>${resource.description || 'No description provided.'}</p><p><strong>File Type:</strong> ${badgeText}</p><p><strong>File Size:</strong> ${fileSize}</p><p><strong>Uploaded:</strong> ${uploadDate}</p></div>`;
            }

            content.innerHTML = `
                <div class="preview-header">
                    <h2>${resource.title}</h2>
                    <button class="close-preview" onclick="closePreview()"><i class="fas fa-times"></i></button>
                </div>
                <div class="preview-body">
                    ${previewHTML}
                    <div class="file-details">
                        <div style="display:flex; justify-content:space-between; flex-wrap:wrap; gap:15px; margin-bottom:20px;">
                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                <span class="file-type-badge ${badgeClass}"><i class="fas ${icon}"></i> ${badgeText}</span>
                                <span style="color:var(--gray-600); font-weight:500;">${fileSize}</span>
                                ${isMyResource?'<span class="user-badge"><i class="fas fa-user"></i> Your Upload</span>':''}
                            </div>
                            <div class="file-actions">
                                <button class="download-btn" onclick="downloadResource(${resource.id})"><i class="fas fa-download"></i> Download</button>
                                <button class="btn btn-secondary" onclick="likeResource(${resource.id})"><i class="fas fa-thumbs-up"></i> Like (${likes})</button>
                            </div>
                        </div>
                        <div class="file-details-grid">
                            <div class="detail-item"><span class="detail-label">Course</span><span class="detail-value">${resource.category || 'General'}</span></div>
                            <div class="detail-item"><span class="detail-label">Uploaded by</span><span class="detail-value">${resource.author || 'Unknown'}</span></div>
                            <div class="detail-item"><span class="detail-label">Upload date</span><span class="detail-value">${uploadDate}</span></div>
                            <div class="detail-item"><span class="detail-label">Views</span><span class="detail-value">${views}</span></div>
                            <div class="detail-item"><span class="detail-label">Downloads</span><span class="detail-value">${resource.downloads || 0}</span></div>
                            <div class="detail-item"><span class="detail-label">Privacy</span><span class="detail-value">${resource.privacy || 'public'}</span></div>
                        </div>
                        ${resource.description ? `<div style="margin-top:20px; border-top:1px solid var(--gray-200); padding-top:20px;"><h4>Description</h4><p style="color:var(--gray-700); line-height:1.6;">${resource.description}</p></div>` : ''}
                    </div>
                </div>
            `;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            showLoading(false);

        } catch (error) {
            console.error(error);
            showNotification('Failed to load resource', 'error');
            showLoading(false);
        }
    }

    function closePreview() {
        const modal = document.getElementById('previewModal');
        if (!modal) return;
        modal.style.display = 'none';
        document.body.style.overflow = '';
        currentPreviewResource = null;
        loadAllResources();
    }

    // =========================
    // Download & Like
    // =========================
    async function downloadResource(id) {
        try {
            window.open(`/api/resources/${id}/download`, '_blank');
            showNotification('Download started', 'success');
        } catch (error) {
            showNotification('Failed to download', 'error');
        }
    }

    async function likeResource(id) {
        try {
            const res = await fetch(`/api/resources/${id}/like`, {method:'POST'});
            const result = await res.json();
            if (result.success) {
                const btn = document.querySelector('.preview-body .btn-secondary');
                if (btn) btn.innerHTML = `<i class="fas fa-thumbs-up"></i> Like (${result.likes})`;
                const idx = allResources.findIndex(r => r.id===id);
                if (idx!==-1) allResources[idx].likes = result.likes;
                showNotification('Resource liked!', 'success');
            } else showNotification('Failed to like resource', 'error');
        } catch (error) {
            showNotification('Failed to like resource', 'error');
        }
    }

    // =========================
    // Quick Stats & Stats
    // =========================
    function updateStats() {
        const totalResources = allResources.length;
        const totalVideos = allResources.filter(r => r.file_category==='video').length;
        const totalDocuments = allResources.filter(r => ['pdf','doc'].includes(r.file_category)).length;
        const totalCourses = new Set(allResources.map(r => r.category).filter(Boolean)).size || 1;

        if(document.getElementById('totalResources')) document.getElementById('totalResources').textContent = totalResources;
        if(document.getElementById('totalVideos')) document.getElementById('totalVideos').textContent = totalVideos;
        if(document.getElementById('totalDocuments')) document.getElementById('totalDocuments').textContent = totalDocuments;
        if(document.getElementById('totalCourses')) document.getElementById('totalCourses').textContent = totalCourses;
    }

    function renderQuickStats() {
        const stats = [
            { type:'video', count:allResources.filter(r=>r.file_category==='video').length, icon:'fa-play-circle', color:'icon-video' },
            { type:'document', count:allResources.filter(r=>['pdf','doc'].includes(r.file_category)).length, icon:'fa-file-alt', color:'icon-doc' },
            { type:'image', count:allResources.filter(r=>r.file_category==='image').length, icon:'fa-image', color:'icon-image' },
            { type:'audio', count:allResources.filter(r=>r.file_category==='audio').length, icon:'fa-music', color:'icon-audio' },
            { type:'other', count:allResources.filter(r=>!['video','pdf','doc','image','audio'].includes(r.file_category)).length, icon:'fa-file', color:'icon-other' }
        ];
        const container=document.getElementById('quickStats');
        if(!container) return;
        container.innerHTML = stats.map(stat => `
            <div class="stat-item">
                <div class="stat-icon ${stat.color}"><i class="fas ${stat.icon}"></i></div>
                <div class="stat-info"><h3>${stat.count}</h3><p>${stat.type.charAt(0).toUpperCase()+stat.type.slice(1)}${stat.type!=='other'?'s':' Files'}</p></div>
            </div>
        `).join('');
    }

    // =========================
    // Utilities
    // =========================
    function getFileIcon(cat){ const icons={video:"fa-video",pdf:"fa-file-pdf",doc:"fa-file-word",presentation:"fa-file-powerpoint",spreadsheet:"fa-file-excel",code:"fa-code",image:"fa-image",audio:"fa-music",other:"fa-file",zip:"fa-file-archive"}; return icons[cat]||'fa-file'; }
    function getFileTypeText(cat){ const texts={video:"Video",pdf:"PDF",doc:"Document",presentation:"Presentation",spreadsheet:"Spreadsheet",code:"Code",image:"Image",audio:"Audio",other:"Other",zip:"ZIP"}; return texts[cat]||'File'; }
    function formatFileSize(bytes){ if(bytes===0)return'0 B'; const k=1024,sizes=['B','KB','MB','GB','TB'],i=Math.floor(Math.log(bytes)/Math.log(k)); return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i]; }
    function getDefaultThumbnail(category,course){ return `https://source.unsplash.com/600x400/?${category},${course}`; }

</script>
{% endblock %}

